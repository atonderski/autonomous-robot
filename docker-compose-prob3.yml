version: '2'

services:
    autonomous-robot:
        image: autonomous-robot:armhf
        depends_on:
          - detector
        command: "--cid=112 --freq=10 --stalker"

    device-camera-rpicamv2:
        image: chalmersrevere/opendlv-device-camera-rpicamv2-armhf:v0.0.1
        volumes:
          - "/dev/shm:/dev/shm"
        privileged: true
        ulimits:
          memlock:
            soft: 4000000
            hard: 4000000
        command: "/usr/bin/opendlv-device-camera-rpicamv2 --cid=112"
    
    detector:
        image: detector:armhf
        depends_on:
          - device-camera-rpicamv2
        restart: always
        working_dir: /opt/
        volumes:
          - "/dev/shm:/dev/shm"
          - .:/opt/
        privileged: true
        ulimits:
          memlock:
            soft: 4000000
            hard: 4000000
        command: "/usr/bin/detector --cid=112 --name=cam0 --scale=1.1 --num-neighbours=30 --verbose"
